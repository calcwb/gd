{% extends "base.html" %}

{% block css %}
<link rel="stylesheet" href="{{ url_for('.static', filename='css/audience.css') }}">

{% endblock %}

{% block javascript %}
<script src="{{ url_for('buzz.static', filename='js/socket.io.js') }}"></script>
<script src="{{ url_for('buzz.static', filename='js/buzz.js') }}"></script>
<script src="{{ url_for('.static', filename='js/jQueryRotate.2.1.js') }}"></script>
<script src="{{ url_for('.static', filename='js/statusbar.js') }}"></script>
<script src="{{ url_for('.static', filename='js/audience.js') }}"></script>
<script src="{{ url_for('.static', filename='js/timer.js') }}"></script>
{% endblock %}

{% block content %}

<div id="container">
  <div id="info-aud" class="row">
    <div class="col7">
      <div id="title">
        <p class="title">{{ audience.title }}</p>
        <p class="description">{{ audience.subject }}</p>
      </div>
    </div>
    <div class="col5">
      <div id="date">
        <p class="day">{{ audience.date.strftime('%d') }}</p>
        <p class="month">{{ audience.date.strftime('%b') }}</p>
        <p class="hour">{{ audience.date.strftime('%H') }}h</p>
        <p class="min">{{ audience.date.strftime('%M') }}</p>
      </div>
      <div id="tag">
        <p>Use a hashtag</p>
        <h3>{{ audience.get_main_term() }}</h3>
      </div>
    </div>
    <div class="row-end"></div>
  </div>
  <div class="row buzzbg">
    <div id="main" class="col8">
      <div class="content">
        <div id="how-it-works" rel="#works-like-this">
          <img src="{{ url_for('.static', filename='imgs/big_gear.png') }}"
               id="how-it-works-big-gear" class="big-gear">
          <img src="{{ url_for('.static', filename='imgs/small_gear.png') }}"
               id="how-it-works-small-gear" class="small-gear">
          <img src="{{ url_for('.static', filename='imgs/como_funciona.png') }}"
               class="how-it-works-text">
        </div>
        <div id="works-like-this" class="overlay boverlay">
          <ol>
            <li class="step-1">
              <img
                 src="{{ url_for('.static', filename='imgs/couple.png') }}"
                 class="step-1-couple">
              <div>
                <img
                   src="{{ url_for('.static', filename='imgs/mail_trail.png') }}"
                   class="step-1-mail-trail">
                <img
                   src="{{ url_for('.static', filename='imgs/mail.png') }}"
                   class="step-1-mail">
              </div>

              <p>As pessoas enviam suas contribuições</p>
            </li>
            <li class="step-2">
              <div class="wrapper">
                <div class="gears">
                  <img
                     src="{{ url_for('.static', filename='imgs/step_2_big_gear.png') }}"
                     class="step-2-big-gear">
                  <img
                     src="{{ url_for('.static', filename='imgs/step_2_small_gear.png') }}"
                     class="step-2-small-gear">
                </div>
                <img src="{{ url_for('.static', filename='imgs/networked_cpus.png') }}">
              </div>

              <p>Nossa equipe processa e modera as contribuições</p>

            </li>
            <li class="step-3">
              <div class="wrapper">
                <img
                   src="{{ url_for('.static', filename='imgs/mustache_gentleman.png') }}"
                   class="mustache-gentleman">
                <img
                   src="{{ url_for('.static', filename='imgs/empty_dialog.png') }}"
                   class="mustache-gentleman-dialog">
              </div>
              <p>O Governador comenta as contribuições selecionadas</p>
            </li>
          </ol>

          <a id="saiba-mais-link" href="javascript:show_how_to()"> Saiba mais </a>
          <div id="saiba-mais-text" style="display:none">
            {{ how_to|safe }}
          </div>


        </div>
        {% if audience.started %}
        <div id="beingAnswered">
          {% if notice %}
          <ul class="stream">
            <li class="avatar"><img src="{{ notice.avatar }}"></li>
            <li class="author">@{{ notice.owner_nick }} <em>| {{ notice.type_ }}</em></li>
            <li class="answer">{{ notice.content }}</li>
          </ul>
          {% endif %}
        </div>
        <div id="streaming">{{ audience.embed|safe }}</div>
        {% endif %}
        <div id="misc">
          <h5>Governo Escuta</h5>
          <p>{{ audience.description|safe }}</p>
        </div>
      </div>
    </div>
    <div class="col4">
      <a class="filter" href="javascript:;"
         title="Alternar a exibição de mensagens moderadas">filtro</a>
      <ul id="buzz-public" class="buzz" style="display:none">
      </ul>
      <ul id="buzz-moderated" class="buzz">
        {% for buzz in audience.get_moderated_buzz() %}
        <li>
          <ul class="stream">
            <li class="avatar">
              <img src="{{ buzz.avatar }}">
            </li>
            <li class="author">
              @{{ buzz.owner_nick }} <em>| {{ buzz.type_.name }}</em>
            </li>
            <li class="answer">{{ buzz.content|safe }}</li>
          </ul>
        </li>
        {% endfor %}
      </ul>
      <div id="message-statusbar" class="alert"></div>
      <div id="chat">
        <form id="internal_chat" method="post" action="{{ url_for('buzz.post') }}">
          <input type="hidden" id="aid" name="aid" value="{{ audience.id }}">
          <textarea id="message-area" name="message" placeholder="Poste sua mensagem aqui."></textarea>
          <span class="current-msg-length">300</span>
          <input id="send_comment" type="submit" value="enviar">
        </form>
      </div>
    </div>
  </div>
  <div class="row-end"></div>
</div>

<script type="text/html" id="buzzTemplate">
  <li>
    <ul class="stream">
      <li class="avatar">
        <img src="<%= obj.avatar %>">
      </li>
      <li class="author">@<%= obj.owner_nick %> <em>| <%= obj.type_.name %></em></li>
      <li class="answer"><%= obj.content %></li>
    </ul>
  </li>
</script>

<script type="text/html" id="selectedNotice">
  <ul class="stream">
    <li class="avatar"><img src="<%= obj.avatar %>"></li>
    <li class="author">@<%= obj.owner_nick %><em> | <%= obj.type_.name %></em></li>
    <li class="answer"><%= obj.content %></li>
  </ul>
</script>

{% endblock %}
