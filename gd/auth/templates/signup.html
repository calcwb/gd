{% macro fielderrors(field) -%}
    {%- if field.errors %}
      {%- for error in field.errors %}
        <span class="help-inline">{{error}}</span>
      {%- endfor %}
    {%- endif %}
{%- endmacro %}

{% extends "base.html" %}

{% block css %}
{% endblock %}

{% block javascript %}
{% endblock %}


{% block content %}
<div class="container">
  <div class="row novocadastro">
    <div class="offset1 span10">
      <form class="form-horizontal" method="post" id="signup" action=".">
        <fieldset>
          <legend>Novo cadastro:</legend>

      {{ form.csrf }}
      <div id="auth-error" class="msg error alert alert-error hide"></div>
      <div id="auth-success" class="msg success alert alert-success hide"></div>
      <!-- <div class="signup-form"> -->
      {%include 'parts/flashes.html'%}
      {% if form.social and ret_code != 0 %}
      <div class="alert">
        Você está se autenticando através de uma rede social. Para
        terminar o processo falta apenas preencher os campos abaixo.
      </div>
      {% endif %}

        {% if ret_code == 0 %}

          <div class="alert">
            Obrigado! Agora siga os passos no email que você recebeu para concluir seu cadastro.
          </div>

        {% else %} {#if ret_code == 0#}


          <div class="control-group {%if form.name.errors%}error{%endif%}">
            {{ form.name.label(class='control-label') }}
            <div class="controls">
              {{ form.name(class='span6') }}
            {{fielderrors(form.name)}}
            </div>
          </div>

          <div class="control-group {%if form.email.errors%}error{%endif%}">
            {{ form.email.label(class='control-label')  }}
            <div class="controls">
              {{ form.email(class='span6') }}
            {{fielderrors(form.email)}}
            </div>
          </div>

          <div class="control-group {%if form.email_confirmation.errors%}error{%endif%}">
            {{ form.email_confirmation.label(class='control-label') }}
            <div class="controls">
              {{ form.email_confirmation(class='span6') }}
            {{fielderrors(form.email_confirmation)}}
            </div>
          </div>

          {% if not form.social %}
          <div class="control-group {%if form.password.errors%}error{%endif%}">
            {{ form.password.label(class='control-label') }}
            <div class="controls">
              {{ form.password }}
            {{fielderrors(form.password)}}
            </div>
          </div>

          <div class="control-group {%if form.password_confirmation.errors%}error{%endif%}">
            {{ form.password_confirmation.label(class='control-label') }}
            <div class="controls">
              {{ form.password_confirmation }}
            {{fielderrors(form.password_confirmation)}}
            </div>
          </div>
          {% endif %}

          <div class="control-group {%if form.state.errors%}error{%endif%}">
            {{ form.state.label(class='control-label') }}
            <div class="controls">
              {{ form.state }}
            {{fielderrors(form.state)}}
            </div>
          </div>
          <div class="control-group {%if form.city.errors%}error{%endif%}">
            {{ form.city.label(class='control-label') }}
            <div class="controls">
              {{ form.city }}
            {{fielderrors(form.city)}}
            </div>
          </div>

          <div class="control-group">

            <div class="controls {%if form.accept_tos.errors%}error{%endif%}">
              <label for="accept_tos" class="checkbox maior"><input type="checkbox" value="y" name="accept_tos" id="accept_tos" checked="checked">Você leu e aceitou nossos <a href="javascript:showTos();">Termos de uso</a>?</label>
            </div>

          </div>

          <div class="control-group">
            <div class="controls">
              <label for="receive_email" class="maior checkbox" class='control-label'>
              <input type="checkbox" value="y" name="receive_email" id="receive_email" checked="checked">
              Quero receber atualizações por email.</label>
              <p class="errmsg receive_email-error"></p>
            </div>
          </div>

          <div class="control-group {%if form.receive_sms.errors%}error{%endif%}">
            <div class="controls">
              <label for="receive_sms" class="checkbox maior" class='control-label'>
                <input type="checkbox" value="y" name="receive_sms" id="receive_sms" checked="checked">
                Quero receber atualizações por SMS.
              </label>
              <p class="errmsg receive_sms-error"></p>
            </div>
          </div>


          <h4>Opcional</h4>

          <div class="control-group {%if form.phone.errors%}error{%endif%}">
            {{ form.phone.label(class='control-label') }}
            <div class="controls">
              {{ form.phone }}
            {{fielderrors(form.phone)}}
            </div>
          </div>


          <div class="control-group {%if form.gender.errors%}error{%endif%}">
            {{ form.gender.label(class='control-label') }}
            <div class="controls">
              {{ form.gender }}
            {{fielderrors(form.gender)}}
            </div>
          </div>

          <div class="control-group {%if form.age_group.errors%}error{%endif%}">

            {{ form.age_group.label(class='control-label') }}
            <div class="controls">
              {{ form.age_group }}
            {{fielderrors(form.age_group)}}
            </div>
          </div>

          <div class="control-group {%if form.facebook.errors%}error{%endif%}">
            {{ form.facebook.label(class='control-label') }}
            <div class="controls">
              {{ form.facebook(placeholder="Facebook profile id") }}
            {{fielderrors(form.facebook)}}
            </div>
          </div>

          <div class="control-group {%if form.twitter.errors%}error{%endif%}">
            {{ form.twitter.label(class='control-label') }}
            <div class="controls">
              {{ form.twitter(placeholder="Twitter id sem o @") }}
            {{fielderrors(form.twitter)}}
            </div>
          </div>

          <div class="control-group">
            <a href="{{url_for('.login')}}">Efetuar login</a>
            <input type="submit" class="btn pull-right" value="Cadastrar">
          </div>

        {% endif %} {#if ret_code == 0#}

        </fieldset>
      </form>
    </div>
  </div>
</div>
{% endblock %}
