{% extends "base-obra.html" %}

{%macro temas()%}
  {#Macro para listar os temas, pois podem ser marcados mais de um tema#}
  {%for t in obra.tema%}
    {{obra.tema[t].name}}
    {%if not loop.last%},{%endif%}
  {%endfor%}
{%endmacro%}

{%block css%}
<link rel="stylesheet" href="{{ url_for('static', filename='css/jquery.fancybox.css') }}">
{%endblock%}

{% block javascript %}
<script src="{{ url_for('static', filename='js/vendor/fancybox/jquery.fancybox.js') }}"></script>
<script src="{{ url_for('static', filename='js/monitoramento/monitoramento.js') }}"></script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "21337f2e-2d47-4b1e-b210-c29a8a7e956d", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>
<script>
$('video').mediaelementplayer();
</script>
{% endblock %}

{% block content %}
<div id="monitoramento" class="obra">
  <div class="container">
    <div class="painel">
      <div class="header">
      <div class="row">
        <div class="span8">
          <div class="head">
            <h2>{{obra.title}}</h2>
            <div class="content">
              {{ obra.content|safe }}
            </div>
          </div>
        </div>
        <div class="span4">
          <div class="mapa">
            <!-- <img src="{{ url_for('.static', filename='mapa.png' ) }}"> -->
            <a target="_blank" href="https://maps.google.com.br/maps?q={{obra.custom_fields.gdobra_coordenadas}}&hl=pt&z=18">
              <img src="http://maps.googleapis.com/maps/api/staticmap?center={{obra.custom_fields.gdobra_coordenadas}}&zoom=11&size=370x250&sensor=false">
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="barra">
      <div class="row">
        <div class="span12">
          <ul class="geral">
            <li class="field">
              <ul class="dados-obra">
                <li class="icon">
                  <span class="circle">
                    <i class="icon-ticket icon-2x yellow"></i>
                  </span>
                </li>
                <li class="data"><strong>Tema</strong></li>
                <li class="result">{{temas()}}</li>
              </ul>
            </li>
            <li class="field">
              <ul class="dados-obra">
                <li class="icon">
                  <span class="circle">
                    <i class="icon-calendar icon-2x red"></i>
                  </span>
                </li>
                <li class="data">
                  <strong>Previsão de conclusão</strong>
                </li>
                <li class="result">{{obra.custom_fields.gdobra_fim_previsto|formatarDataObra}}</li>
              </ul>
            </li>
            <li class="field">
              <ul class="dados-obra">
                <li class="icon">
                  <span class="circle"> <i class="icon-money icon-2x green"></i>
                  </span>
                </li>
                <li class="data"><strong>Valor Global</strong></li>
                <li class="result">R$ {{obra.custom_fields.gdobra_valor_global}}</li>
              </ul>
            </li>

            <li class="field">
              <ul class="dados-obra">
                <li class="icon">
                  <span class="circle"> <i class="icon-cogs icon-2x blue"></i>
                  </span>
                </li>
                <li class="data"><strong>Andamento</strong></li>
                <li  class="result">
                  <div class="progressbar">
                    <div class="progress"style=" width:{{obra.custom_fields.gdobra_porc_concluido}}%">
                    </div>
                  </div> {{obra.custom_fields.gdobra_porc_concluido}} %
                </li>
              </ul>
            </li>
            <li class="field">
              <ul class="dados-obra">
                <li class="icon">
                  <span class="circle">
                    <i class="icon-wrench icon-2x orange"></i>
                  </span>
                </li>
                <li class="data"><strong>Empresas responsáveis</strong></li>
                <li class="result">Porto belo</li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
      <div class="row">
        <div class="span3">
          <div class="info">
            <h3>Participe!</h3>
            <div class="botoesparticipar">
              <a href="#participar-geral"  class="filme">
                <i class="icon-facetime-video icon-2x"></i>
                <h4>Filme</h4>
                <p>Compartilhe seus vídeos</p>
              </a>
            </div>

            <div class="separador"></div>

            <div class="follow">
              <h3>Seguir esta obra</h3>
              <p class="desc">
                Escoha a melhor forma de receber as atualizações:</p>
              <ul class="social">
                <li><i class="icon-facebook icon-2x face"></i></li>
                <li><i class="icon-twitter icon-2x twit"></i></li>
                <li><i class="icon-envelope icon-2x email"></i></li>
              </ul>
              <a href="#seguirobraform" class="btn btn-large btn-danger seguirobra">Seguir obra</a>
            </div>

            <div class="separador"></div>

            <!-- <div class="code">
            <a href="#"><h3>Baixe o código QR e espalhe</h3></a>
            <a href="#" class="toottip" data-toggle="tooltip" title="Código QR: lipsum">
            <img src="{{ url_for('.static', filename='qrcode.jpg' ) }}" class="img-polaroid">
            </a><br>
            </div> -->

            <div class="nossodados">
              <h3>Nossos dados</h3>
              <p class="desc">
                Os dados desse site estão disponiveis nos sequintes formatos:
              </p>
              <a href="#" class="api">API</a>
              <a href="#" class="xml">XML</a>
            </div>

            <div class="separador"></div>

            <div class="acessso">
              <h3>Acesso a informação</h3>
              <p class="desc">
                Você será redirecionado para o portal de acesso a informação
              </p>
              <a href="" class="btn">Requerer!</a>
            </div>



          </div>
        </div>
        <div class="span9">
          <div class="stage">
            <div class="suplementar hide">
              <div id="participar-geral">
                <div class="row">
                  <div class="span9">
                  <h2>Enviar contribuição</h2>
                   <p>Envie seu posicionamento sobre esta obra, informe-nos como está andando a obra, sob seu ponto de vista. Sua opinião é muito importante para nós.</p>
                   </div>
                   </div>
                   <div class="row">
                   <div class="span4">
                     <div class="space">
                       <div class="alert message hide">Mensagem</div>
                       <form  id="part-geral" class="form ajaxform" method="POST" action="/monitore/obra/{{obra.slug}}/contribui">
                         <input type="hidden" name="tipo" value="t">
                         <label for="titulo">Título:</label>
                         <input type="text" placeholder="Título..." name="titulo" id="titulo">
                         <label for="conteudo">Sua contribuição</label>
                         <textarea name="conteudo" id="conteudo" placeholder="Digite sua contribuição aqui"></textarea>
                         <div class="btn-group">
                           <a href="#" class="btn inVideo"><i class="icon-facetime-video"></i> Inservir Vídeo</a>
                           <a href="#" class="btn inFoto"><i class="icon-camera"></i> Inserir Foto</a>
                         </div>
                         <div class="video hide">
                           <label for="link">Link do video</label>
                           <input type="text" placeholder="link do seu vídeo..." name="link" id="link">
                         </div>
                         <div class="foto hide">
                         <label for="foto">Sua imagem</label>
                         <input type="file" name="foto" id="foto">
                         </div>

                         <input type="text" placeholder="email" name="email" id="email">

                         <p class="lead">
                           Você possui cadastro no Gabinete Digital ?
                         </p>

                         <div class="comCadastro">
                           <div class="resposta"><big>Sim</big>, eu tenho uma senha</div>

                           <div class="input-append">
                             <input class="span2" id="appendedInputButton" type="password" placeholder="senha">
                             <button class="btn btn-success" type="button">Entrar</button>
                           </div>
                         </div>

                         <div class="semCadastro">
                           <div class="resposta"><big>Não</big>, desejo confirmar por email</div>
                           <input type="text" placeholder="Nome" name="nome" id="nome">
                           <div class="hide telefone">
                             <input type="text" placeholder="Telefone" name="telefone" id="telefone"> (opcional)
                           </div>
                           <div class="hide newPassword">
                             <input type="password" placeholder="Senha" name="password" id="newPassword"> (opcional)
                           </div>
                         </div>

                         <div class="form-footer">
                           <button class="btn" onclick="fechaSuplementar();return false;">Cancelar</button>
                           <button type="submit" class="btn btn-success">Enviar</button>
                         </div>

                       </form>
                     </div>
                  </div>
                  <div class="span5">
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas eu mi
                    lectus, sed porttitor enim. In ultrices mattis mattis. Ut luctus tempus
                    in. Aenean mattis feugiat ligula a vehicula.</p>

                    <p>Curabitur nec vulputate diam. Donec neque enim, condimentum quis
                    ligula. Morbi vulputate diam ullamcorper erat pharetra consequat. Donec
                    molestie auctor nulla sed pretium.</p>

                    <p>Pellentesque sollicitudin purus id odio porttitor a egestas massa
                    convallis nec, dictum vitae quam. Vivamus sed sapien nunc. Integer
                    pulvinar scelerisque elit, eu euismod dui interdum scelerisque.</p>
                  </div>
                </div>
              </div>
            </div>
    {% block subcontent %}

          <div class="comofunciona">
            <div class="content">
              <div class="more">
                +
              </div>
              <div class="close">
                Fechar
              </div>
              <h2>Como funciona ?</h2>
            </div>
          </div>


          <div class="updates">


            {%include 'part_govresp.html'%}


            <p>O que as pessoas estão falando...</p>
            {%set mostra_items = True%}

            <div class="timeline">
              <div class="line"></div>

              {%for update in timeline[1:]%}

              {%if update.format == 'status'%} {#===================================================#}
              {%set mostra_items = False%}
            </div>

            <div class="govresp remote" data-oid="{{obra.slug}}" data-id="{{update.id}}">
              <h2>Governo Responde - {{update.date.date|formatarDataeHora(formato="%d %b, %Y")}}</h2>
            </div>

            <div class="timeline" id="timeline{{update.id}}">
              {%elif mostra_items %} {#===========================================================================#}
              <div class="update {{ update.format }}">

                <div class="seta">
                  <span class="mark"> <span class="dot"></span> </span>
                </div>

                <div class="content">
                  <h4>{{update.title}}</h4>
                  <div class="user">
                    <small>por</small> {{update.author.display_name}} <small>em</small>
                    <a href="{{ url_for('.timelineitem', slug=obra.slug, itemid=update.id) }}">{{update.date.date|formatarDataeHora(formato="%d %b, %Y")}}</a>
                  </div>

                  {%if update.format == 'aside'%}
                  {{update.content|safe}}
                  {%endif%}

                  {%if update.format == 'link'%}
                  <a href="{{update.content|striptags}}">{{update.content|striptags}}</a>
                  {%endif%}

                  {%if update.format == 'video'%}
                  <video width="100%" height="100%" id="player{{update.id}}" preload="none">
                    {% if 'youtube' in update.custom_fields.gdobra_video %}
                    <source type="video/youtube" src="{{update.custom_fields.gdobra_video|striptags}}" />
                    {%else%}
                    <source type="video/vimeo" src="{{update.custom_fields.gdobra_video|striptags}}" />
                    {%endif%}
                  </video>
                  <script type="text/javascript">
                  $('#player{{update.id}}').mediaelementplayer({});
                  </script>
                  {%endif%}

                  {%if update.format == 'image'%}
                  <img src="{{ update.thumbs.normal.url }}">
                  {%endif%}
                </div>

                <div class="participe">
                  <p>Isso é importante?</p>
                  {%if user and not user.username in update.custom_fields.gdobra_users_voted %}
                  <a class="votar" href="/monitore/obra/{{update.id}}/{{update.slug|md5}}/{{[update.id|string,'1']|join("")|md5}}/">
                    <i class="icon-star-empty"></i>
                  </a>
                  {%elif not user%}
                  <a class="need" href="#"><i class="icon-star-empty"></i></a>
                  {%else%}
                  <i class="icon-star"></i>
                  {%endif%}
                  <p class="counter">{{update.custom_fields.gdobra_voto_score or "0"}}</p>
                  <span class="need hide">Você precisa se <a href="{{url_for('auth.login')}}">logar</a></span>
                </div>

              </div>
              {%endif%} {#==========================================================================#}

              {%endfor%}
            </div> <!-- fim timeline -->
          </div> <!-- fim updates -->

    {%endblock%}

        </div> <!-- fim span9 -->
      </div>
    </div>
  </div>
</div>


<div id="seguirobraform" style="display:none; width:450px;">
  <h3>Quer seguir esta obra ?</h3>
  <div class="main-follow">
    <a href="#" target="#follow-email"><i class="icon-envelope icon-3x email"></i></a>
    <a href="#" target="#follow-facebook"><i class="icon-facebook icon-3x face"></i></a>
    <a href="#" target="#follow-twitter"><i class="icon-twitter icon-3x twit"></i></a>
    <div class="follow follow-email hide" id="follow-email">
      <div class="alert message hide">Mensagem</div>
      <form class="form form-inline ajaxform" action="/monitore/obra/seguir/{{obra.id}}" method="POST">
        <label for="faceid">Seu e-mail:</label>
        <input type="text" name="email" id="email">
        <input type="submit" class="btn btn-success" value="Seguir">
      </form>
    </div>
    <div class="follow follow-facebook" id="follow-facebook">
      <div class="alert message hide">Mensagem</div>
      <form class="form form-inline ajaxform" action="/monitore/obra/seguir/{{obra.id}}" method="POST">
        <label for="faceid">Facebook ID:</label>
        <input type="text" name="faceid" id="faceid">
        <input type="submit" class="btn btn-success" value="Seguir">
      </form>
    </div>
    <div class="follow follow-twitter hide" id="follow-twitter">
      <div class="alert message hide">Mensagem</div>
      <form class="form form-inline ajaxform" action="/monitore/obra/seguir/{{obra.id}}" method="POST">
        <label for="faceid">Twitter ID:</label>
        <input type="text" name="twitterid" id="twitterid">
        <input type="submit" class="btn btn-success" value="Seguir">
      </form>
    </div>
  </div>
</div>


{% endblock %}
