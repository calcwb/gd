{% extends "base.html" %}

{% block css %}
<link rel="stylesheet" href="{{ url_for('.static', filename='css/audience.css') }}">
{% endblock %}

{% block javascript %}
<script src="{{ url_for('buzz.static', filename='js/socket.io.js') }}"></script>
<script src="{{ url_for('buzz.static', filename='js/buzz.js') }}"></script>
<script src="{{ url_for('.static', filename='js/jQueryRotate.2.1.js') }}"></script>
<script src="{{ url_for('.static', filename='js/audience.js') }}"></script>
<script src="{{ url_for('.static', filename='js/timer.js') }}"></script>
{% endblock %}

{% block content %}

<div id="container">
  <div id="info-aud" class="row">
    <div class="col7">
      <div id="title">
        <p class="title">{{ audience.title }}</p>
        <p class="description">{{ audience.subject }}</p>
      </div>
    </div>
    <div class="col5">
      <div id="date">
        <p class="day">{{ audience.date.strftime('%d') }}</p>
        <p class="month">{{ audience.date.strftime('%b') }}</p>
        <p class="hour">{{ audience.date.strftime('%H') }}h</p>
        <p class="min">{{ audience.date.strftime('%M') }}</p>
      </div>
      <div id="tag">
        <p>Use a hashtag</p>
        <h3>{{ audience.get_main_term() }}</h3>
      </div>
    </div>
    <div class="row-end"></div>
  </div>
  <div class="row">
    <div id="main" class="col8">
      <div class="content">
        <div id="how-it-works">
          <img src="{{ url_for('.static', filename='imgs/big_gear.png') }}"
               id="how-it-works-big-gear" class="big-gear">
          <img src="{{ url_for('.static', filename='imgs/small_gear.png') }}"
               id="how-it-works-small-gear" class="small-gear">
          <img src="{{ url_for('.static', filename='imgs/como_funciona.png') }}"
               class="how-it-works-text" onclick="audience_show_how_it_works()">
        </div>
        <div id="works-like-this">
          <ol>
            <li class="step-1">
              <img src="{{ url_for('.static', filename='imgs/couple.png') }}" class="step-1-couple">
              <div>
                <img src="{{ url_for('.static', filename='imgs/mail_trail.png') }}" class="step-1-mail-trail">
                <img src="{{ url_for('.static', filename='imgs/mail.png') }}" class="step-1-mail">
              </div>
            </li>
            <li class="step-2">
              <div>
                <img src="{{ url_for('.static', filename='imgs/step_2_big_gear.png') }}" class="step-2-big-gear">
                <img src="{{ url_for('.static', filename='imgs/step_2_small_gear.png') }}" class="step-2-small-gear">
              </div>
              <img src="{{ url_for('.static', filename='imgs/networked_cpus.png') }}">
            </li>
            <li class="step-3">
              <img src="{{ url_for('.static', filename='imgs/mustache_gentleman.png') }}" class="mustache-gentleman">
              <img src="{{ url_for('.static', filename='imgs/empty_dialog.png') }}" class="mustache-gentleman-dialog">
            </li>
          </ol>
        </div>
        {% if audience.started %}
        {% set notice = audience.get_last_published_notice() %}
        {% if notice %}
        <ul class="stream">
          <li class="avatar">
            <img src="{{ notice.owner_avatar }}">
          </li>
          <li class="author">
            @{{ notice.owner_nick }} <em>| {{ notice.type_ }}</em>
          </li>
          <li class="answer">{{ notice.content }}</li>
        </ul>
        {% endif %}
        <div id="streaming">{{ audience.embed|safe }}</div>
        {% endif %}
        <div id="misc">
          <h2>Governo Escuta</h2>
          <p>{{ audience.description|safe }}</p>
        </div>
      </div>
    </div>
    <div class="col4">
      <a class="filter" href="javascript:;"
         title="Alternar a exibição de mensagens moderadas">filtro</a>
      <ul id="buzz">
        {% for buzz in audience.get_moderated_buzz() %}
        <li>
          <ul class="stream">
            <li class="avatar">
              <img src="{{ buzz.owner_avatar }}">
            </li>
            <li class="author">
              @{{ buzz.owner_nick }} <em>| {{ buzz.type_.name }}</em>
            </li>
            <li class="answer">{{ buzz.content|safe }}</li>
          </ul>
        </li>
        {% endfor %}
      </ul>
      <div id="chat">
        <form id="internal_chat" method="post" action="{{ url_for('buzz.post') }}">
          <input type="hidden" id="aid" name="aid" value="{{ audience.id }}">
          <textarea name="message" placeholder="Poste sua mensagem aqui."></textarea>
          <input type="submit" value="enviar">
        </form>
      </div>
    </div>
  </div>
  <div class="row-end"></div>
</div>

<script type="text/html" id="buzzTemplate">
  <li>
    <ul class="stream">
      <li class="avatar">
        <img src="<%= obj.owner_avatar %>">
      </li>
      <li class="author">@<%= obj.owner_nick %> <em>| <%= obj.type_.name %></em></li>
      <li class="answer"><%= obj.content %></li>
    </ul>
  </li>
</script>

{% endblock %}
